---
title: "MLR"
format: html
---

```{r}
#| label: setup
#| message: false
library(tidyverse)
options(paged.print = FALSE)
```


## Data

```{r}
# Data for constructed example
set.seed(1234)
df <- data.frame(W = rep(c(FALSE, TRUE), each = 100))  |> 
  mutate(
    X = .5 + 2 * W + rnorm(200),
    Y = -.5 * X + 4 * W + 1 + rnorm(200)
    )
```

```{r}
df2 <- df |> 
  group_by(W) |> 
  mutate(
    mean_X = mean(X), 
    mean_Y = mean(Y)
    )  |> 
  ungroup()
```

```{r}
df2
```


```{r}
df2 |> 
  ggplot(
    mapping = aes(x = X, y = Y)
    ) +
  geom_point(
    size = 3
  ) +
  geom_smooth(
    formula = 'y ~ x',
    method = lm, 
    se = FALSE, 
    color = 'blue'
    )
```

```{r}
df2 |> 
  mutate(W = fct(as.character(W))) |> 
  ggplot(
    mapping = aes(x = X, y = Y),
    ) +
  geom_point(
    mapping = aes(colour = W),
    size = 3
  ) +
  geom_smooth(
    formula = 'y ~ x',
    method = lm, 
    se = FALSE, 
    color = 'blue'
    )
```

```{r}
df2 |> 
  mutate(W = fct(as.character(W))) |> 
  ggplot(
    mapping = aes(x = X, y = Y),
    ) +
  geom_point(
    mapping = aes(colour = W),
    size = 3
  ) +
  geom_smooth(
    formula = 'y ~ x',
    method = lm, 
    se = FALSE, 
    color = 'blue'
    ) +
  facet_wrap(
    ~ W
  )
```

Bare for å vise hva man kan gjøre hvis man trenger å lage et slik diagram (oppdatert kode også i slides)

```{r}
dag1 <- ggdag::dagify(
  Y ~ X + W, X ~ W,
  exposure = "X",
  outcome = "Y"
  )

XYW <- ggplot(
  data = dag1, 
  aes(
    x = x, y = y, 
    xend = xend, 
    yend = yend)
  ) +
  ggdag::geom_dag_point(
    color = 'red2'
    ) +
  ggdag::geom_dag_edges() +
  ggdag::geom_dag_text() +
  ggdag::theme_dag()

XYW
```


```{r}
mtcars |> 
  select(mpg, wt) |> 
  ggplot(mapping = aes(x = wt, y = mpg)) +
  geom_point(size = 3) + 
  geom_smooth(
    method = "lm", 
    formula = "y ~ x", 
    se = FALSE
    ) +
  xlim(0, 6) +
  ylim(0, 35)
```

```{r}
mtcars |> 
  select(mpg, wt, cyl) |> 
  arrange(cyl) |> 
  mutate(
    cyl = fct(as.character(cyl))
  ) |> 
  ggplot(mapping = aes(x = wt, y = mpg)) +
  geom_point(
    mapping = aes(colour = cyl),
    size = 3) + 
  geom_smooth(
    method = "lm", 
    formula = "y ~ x", 
    se = FALSE
    ) +
  xlim(0, 6) +
  ylim(0, 35)
```


```{r}
mtcars |> 
  select(mpg, wt, cyl) |> 
  arrange(cyl) |> 
  mutate(
    cyl = fct(as.character(cyl))
  ) |> 
  ggplot(mapping = aes(x = wt, y = mpg)) +
  geom_point(
    mapping = aes(colour = cyl),
    size = 3) + 
  geom_smooth(
    method = "lm", 
    formula = "y ~ x", 
    se = FALSE
    ) +
  xlim(0, 6) +
  ylim(0, 35) +
  facet_wrap(
    ~cyl
  )
```

